"$schema" = "https://jj-vcs.github.io/jj/prerelease/config-schema.json"

[user]
name = "Scott Taylor"
email = "scott11x8@gmail.com"

[ui]
default-command = "log"
pager = ["less", "-FRXx4"]
diff-formatter = ":git"
diff-editor = ":builtin"
conflict-marker-style = "diff-experimental"

[merge]
hunk-level = "word"

[hints]
resolving-conflicts = false

[git]
private-commits = "private()"

[colors]
"node working_copy" = { fg = "bright green", bold = true }
"node current_operation" = { fg = "bright green", bold = true }
"diff removed token" = { fg = "bright red", bg = "#400000", underline = false }
"diff added token" = { fg = "bright green", bg = "#003000", underline = false }

[fix.tools.rustfmt]
command = ["rustfmt", "--emit", "stdout"]
patterns = ["glob:**/*.rs"]

[aliases]
trunk = ["log", "-r", "first_ancestors(trunk())"]
stack = ["log", "-r", "context(stack())"]
work = ["log", "-r", "context(work())"]
conflict = ["new", "roots(stack() & conflicts())"]
tug = [
    "bookmark", "move",
    "--from", "heads(first_ancestors(first_parent(@)) & bookmarks())",
    "--to", "head()",
]
rebase-all = ["rebase", "-s", "roots(trunk().. & mutable())", "-d", "trunk()"]

[revsets]
log = "log()"
short-prefixes = "log() ~ (@ & description(exact:''))"

[revset-aliases]
"log()" = "context(mutable())"
"context(x)" = "@ | trunk() | ancestors(x, 2)"
"head()" = "coalesce(@ ~ description(exact:''), first_parent(@))"
"private()" = 'mutable() & description(regex:"(?i)^(private|wip)(\n*$|:)")'
"stack()" = "reachable(present(@), mutable())"
"work()" = "reachable(present(@) | bookmarks(), mutable())"
# Make commits by other users immutable
"immutable_heads()" = "builtin_immutable_heads() | ~mine()"
# visible_heads() is required here to ensure that only visible commits are shown
"local_log(trunk)" = "ancestors((parents(trunk, 4) | immutable_heads())..visible_heads() | present(@), 2)"
# Alias to quickly switch to another branch
"/" = "latest(heads(mutable() ~ reachable(@, mutable())))"

[templates]
git_push_bookmark = '"scott2000/" ++ change_id.short(8)'
log_node = '''
if(self && !current_working_copy && !immutable && !conflict && in_branch(self),
  "â—‡",
  builtin_log_node
)
'''

[template-aliases]
"format_timestamp(timestamp)" = "timestamp.ago()"
"format_detailed_signature(signature)" = """
  if(signature.name(), signature.name(), name_placeholder)
  ++ " <" ++ if(signature.email(), signature.email(), email_placeholder) ++ ">"
  ++ " (" ++ signature.timestamp().local().format("%F %r") ++ ")"
"""
"in_branch(commit)" = 'commit.contained_in("immutable_heads()..bookmarks()")'

